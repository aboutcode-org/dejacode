{% load i18n %}
{% load inject_preserved_filters from dje_tags %}
{% load urlize_target_blank from dje_tags %}
{% load naturaltime_short from dje_tags %}

<table id="object-list-table" class="table table-bordered table-striped table-md text-break vulnerabilities-table">
  {% include 'includes/object_list_table_header.html' %}
  <tbody>
  {% for vulnerability in object_list %}
    <tr>
      <td>
        <strong>
          {% if vulnerability.resource_url %}
            <a href="{{ vulnerability.resource_url }}" target="_blank">
              {{ vulnerability.vulnerability_id }}
              <i class="fa-solid fa-up-right-from-square mini"></i>
            </a>
          {% else %}
            {{ vulnerability.vulnerability_id }}
          {% endif %}
        </strong>
        <div class="mt-2">
          {% include 'component_catalog/includes/vulnerability_aliases.html' with aliases=vulnerability.aliases only %}
        </div>
      </td>
      <td>
        {% if vulnerability.summary %}
          {% if vulnerability.summary|length > 120 %}
            <details>
              <summary>{{ vulnerability.summary|slice:":120" }}...</summary>
              {{ vulnerability.summary|slice:"120:" }}
            </details>
          {% else %}
            {{ vulnerability.summary }}
          {% endif %}
        {% endif %}
      </td>
      <td>
        {{ vulnerability.get_exploitability_display }}
      </td>
      <td>
        {{ vulnerability.weighted_severity|default_if_none:"" }}
      </td>
      <td class="fs-110pct">
        {% include 'component_catalog/includes/risk_score_badge.html' with risk_score=vulnerability.risk_score only %}
      </td>
      <td>
        {% if vulnerability.affected_products_count %}
          <a href="{% url 'product_portfolio:product_list' %}?affected_by={{ vulnerability.vulnerability_id }}">
            {{ vulnerability.affected_products_count }}
          </a>
        {% else %}
          0
        {% endif %}
      </td>
      <td>
        {% if vulnerability.affected_packages_count %}
          <a href="{% url 'component_catalog:package_list' %}?affected_by={{ vulnerability.vulnerability_id }}">
            {{ vulnerability.affected_packages_count }}
          </a>
        {% else %}
          0
        {% endif %}
      </td>
      <td>
        {{ vulnerability.fixed_packages_count }}
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="10">No results.</td></tr>
  {% endfor %}
  </tbody>
</table>